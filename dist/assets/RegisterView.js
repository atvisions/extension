import{d as e,r as a,o as l,c as r,b as o,u as s,q as t,s as i,v as n,x as d,t as u,k as c,l as m,m as p,h as v,p as g}from"./main.js";import{b}from"./index.js";const f={class:"min-h-screen flex flex-col bg-[#0F172A] overflow-y-auto"},y={class:"fixed top-0 w-full z-10 bg-[#0F172A]/95 backdrop-blur-md border-b border-gray-800"},x={class:"max-w-[375px] mx-auto"},w={class:"flex items-center px-4 py-3"},h={class:"flex-1 pt-16 pb-16"},k={class:"max-w-[375px] mx-auto px-4"},_={class:"flex gap-2"},I={class:"flex-1"},S=["disabled"],q=["disabled"],F={class:"mt-6 text-center"},V=e({__name:"RegisterView",setup(e){const V=t(),j=a({email:"",password:"",code:"",invitation_code:""}),A=a(!1),U=a(!1),$=a(0),C=()=>{localStorage.setItem("registerFormData",JSON.stringify({email:j.value.email,password:j.value.password,code:j.value.code}))},D=()=>{C()},O=()=>{C()},R=()=>{C()},J=async()=>{if(j.value.email){U.value=!0;try{await b.sendCode({email:j.value.email}),(()=>{$.value=60;const e=setInterval((()=>{$.value--,$.value<=0&&clearInterval(e)}),1e3)})()}catch(e){console.error("发送验证码失败:",e),alert("发送验证码失败")}finally{U.value=!1}}else alert("请输入邮箱")},N=async()=>{var e,a,l,r,o;if(j.value.email&&j.value.password&&j.value.code&&j.value.invitation_code){A.value=!0;try{const e={email:j.value.email.trim(),password:j.value.password.trim(),code:j.value.code.trim(),invitation_code:j.value.invitation_code.trim()};console.log("Sending registration request with data:",e);const a=await b.register(e);console.log("Registration response:",a),localStorage.removeItem("registerFormData"),V.push("/login")}catch(s){if(console.error("Registration failed:",s),null==(l=null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.message)?void 0:l.code)alert(`验证码错误: ${s.response.data.message.code[0]}`);else if(null==(o=null==(r=s.response)?void 0:r.data)?void 0:o.message){const e=Object.entries(s.response.data.message).map((([e,a])=>`${e}: ${Array.isArray(a)?a[0]:a}`)).join("\n");alert(e)}else alert("注册失败，请检查输入信息")}finally{A.value=!1}}else alert("请填写所有必填字段")};return l((()=>{(()=>{const e=localStorage.getItem("registerFormData");if(e){const{email:a,password:l,code:r}=JSON.parse(e);j.value.email=a,j.value.password=l,j.value.code=r}})()})),(e,a)=>{const l=p("router-link");return g(),r("div",f,[o("header",y,[o("div",x,[o("div",w,[o("button",{onClick:a[0]||(a[0]=e=>s(V).push("/")),class:"mr-2"},a[5]||(a[5]=[o("i",{class:"ri-arrow-left-line ri-lg"},null,-1)])),a[6]||(a[6]=o("h1",{class:"text-lg font-semibold"},"注册",-1))])])]),o("main",h,[o("div",k,[a[12]||(a[12]=o("h1",{class:"text-2xl font-bold text-center mb-8"},"注册",-1)),o("form",{onSubmit:i(N,["prevent"]),class:"space-y-4"},[o("div",null,[a[7]||(a[7]=o("label",{class:"block text-sm font-medium text-gray-400 mb-1"},"邮箱",-1)),n(o("input",{type:"email","onUpdate:modelValue":a[1]||(a[1]=e=>j.value.email=e),onInput:D,required:"",class:"w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 focus:border-primary focus:ring-1 focus:ring-primary outline-none",placeholder:"请输入邮箱"},null,544),[[d,j.value.email]])]),o("div",null,[a[8]||(a[8]=o("label",{class:"block text-sm font-medium text-gray-400 mb-1"},"密码",-1)),n(o("input",{type:"password","onUpdate:modelValue":a[2]||(a[2]=e=>j.value.password=e),onInput:O,required:"",class:"w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 focus:border-primary focus:ring-1 focus:ring-primary outline-none",placeholder:"请输入密码"},null,544),[[d,j.value.password]])]),o("div",_,[o("div",I,[a[9]||(a[9]=o("label",{class:"block text-sm font-medium text-gray-400 mb-1"},"验证码",-1)),n(o("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=e=>j.value.code=e),onInput:R,required:"",class:"w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 focus:border-primary focus:ring-1 focus:ring-primary outline-none",placeholder:"请输入验证码"},null,544),[[d,j.value.code]])]),o("button",{type:"button",onClick:J,disabled:U.value||$.value>0,class:"mt-6 px-4 py-2 bg-gray-800 text-white rounded-lg text-sm disabled:opacity-50 disabled:cursor-not-allowed"},u($.value>0?`${$.value}s后重试`:U.value?"发送中...":"获取验证码"),9,S)]),o("div",null,[a[10]||(a[10]=o("label",{class:"block text-sm font-medium text-gray-400 mb-1"},"邀请码",-1)),n(o("input",{type:"text","onUpdate:modelValue":a[4]||(a[4]=e=>j.value.invitation_code=e),required:"",class:"w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 focus:border-primary focus:ring-1 focus:ring-primary outline-none",placeholder:"请输入邀请码"},null,512),[[d,j.value.invitation_code]])]),o("button",{type:"submit",class:"w-full py-3 bg-gradient-to-r from-primary to-blue-500 text-white rounded-lg font-medium",disabled:A.value},u(A.value?"注册中...":"注册"),9,q)],32),o("div",F,[c(l,{to:"/login",class:"text-primary hover:underline"},{default:m((()=>a[11]||(a[11]=[v(" 已有账号？立即登录 ")]))),_:1})])])])])}}});export{V as default};
